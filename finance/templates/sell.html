{% extends "layout.html" %}

{% block title %}
    Sell
{% endblock %}

{% block main %}
    <h1>Sell</h1>
    <form action="/sell" method="POST">
        <div class="mb-3">
            <select class="form-control mx-auto w-auto" name="symbol" id="symbol" required>
                <option value="">Select a stock</option>
                {% for stock in stocks %}
                    <option value="{{ stock['symbol'] }}">{{ stock['symbol'] }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <select class="form-control mx-auto w-auto" id="shares" name="shares" required>
                <option value="">Select number of shares</option>
            </select>
        </div>

        <button class="btn btn-primary" type="submit">Sell</button>
    </form>

<script>
document.addEventListener("DOMContentLoaded", function () {
    // Get references to the stock symbol and shares dropdowns
    const symbolSelect = document.getElementById("symbol");
    const sharesSelect = document.getElementById("shares");

    // Initialize a map to store stock symbols and their available shares
    const stockShares = {};

    // Loop through each available stock and store its shares in the map
    {% for stock in stocks %}
        stockShares["{{ stock['symbol'] }}"] = {{ stock['total_shares'] }};
    {% endfor %}

    // This function is called when the stock symbol changes
    symbolSelect.addEventListener("change", function () {
        const selectedSymbol = symbolSelect.value;

        // Clear the existing options in the shares dropdown
        sharesSelect.innerHTML = "";

        // Add options for the selected stock, based on the number of shares
        if (selectedSymbol && stockShares[selectedSymbol] > 0) {
            const totalShares = stockShares[selectedSymbol];
            for (let i = 1; i <= totalShares; i++) {
                const option = document.createElement("option");
                option.value = i;
                option.textContent = i;
                sharesSelect.appendChild(option);
            }
        }
    });
});
</script>

{% endblock %}
