{% extends "layout.html" %}

{% block title %}
    Sell
{% endblock %}

{% block main %}
    <h1>Sell</h1>
    <form action="/sell" method="POST">
        <div class="mb-3">
            <select class="form-control mx-auto w-auto" name="symbol" id="symbol" required>
                <option value="">Select a stock</option>
                {% for stock in stocks %}
                    <option value="{{ stock['symbol'] }}">{{ stock['symbol'] }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <select class="form-control mx-auto w-auto" id="shares" name="shares" required>
                <option value="">Select number of shares</option>
            </select>
        </div>

        <button class="btn btn-primary" type="submit">Sell</button>
    </form>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const symbolSelect = document.getElementById("symbol");
            const sharesSelect = document.getElementById("shares");

            // Create a map to store the stock shares
            const stockShares = {};
            {% for stock in stocks %}
                stockShares["{{ stock['symbol'] }}"] = {{ stock['total_shares'] }};
            {% endfor %}

            // Function to update the shares dropdown based on selected stock
            function updateSharesDropdown() {
                const selectedSymbol = symbolSelect.value;
                sharesSelect.innerHTML = "<option value='' disabled selected>Select shares</option>";

                if (selectedSymbol && stockShares[selectedSymbol]) {
                    for (let i = 1; i <= stockShares[selectedSymbol]; i++) {
                        const option = document.createElement("option");
                        option.value = i;
                        option.textContent = i;
                        sharesSelect.appendChild(option);
                    }
                } else {
                    const option = document.createElement("option");
                    option.value = "";
                    option.textContent = "No shares available";
                    sharesSelect.appendChild(option);
                }
            }

            // Call updateSharesDropdown on symbol change
            symbolSelect.addEventListener("change", updateSharesDropdown);

            // Initialize the shares dropdown on page load if a symbol is already selected
            if (symbolSelect.value) {
                updateSharesDropdown();
            }
        });
        </script>


{% endblock %}
