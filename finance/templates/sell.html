{% extends "layout.html" %}
{% block title %}
    Sell
{% endblock %}

{% block main %}
    <h1>Sell</h1>
    <form action="/sell" method="POST">
        <div class="mb-3">
            <select class="form-control mx-auto w-auto" name="symbol" id="symbol" required>
                <option value="">Select a stock</option>
                {% for stock in stocks %}
                    <option value="{{ stock['symbol'] }}">{{ stock['symbol'] }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <input class="form-control mx-auto w-auto" id="shares" name="shares" required>
                <option value="">Select number of shares</option>
            </input>
        </div>

        <button class="btn btn-primary" type="submit">Sell</button>
    </form>



<!--This is my personal touch. Some simple javascript to limit the dropdown menu for shares.
 Shares dropdown will be updated to only allow up to the amount of shares owned of the individual stock
 for the user. Example, 9 shares of tesla stock, the dropwdown menu is limited to 9. If the user changes
 their mind after selecting tesla, and decideds to sell apple instea, the dropdown will change to limit
 up to the amount of apple instead of tesla shares.
-->
<script>

// create event listeners for symbols and shares drop downs
document.addEventListener("DOMContentLoaded", function(){
    const symbolSelect = document.getElementById("symbol");
    const sharesInput = document.getElementById("shares");

    // create a map to store symbol and its available shares
    const stockShares = {};

    // loop through each stock and shares to store in map
    {% for stock in stocks %}
        stockShares["{{ stock['symbol'] }}"] = {{ stock['total_shares'] }};
    {% endfor %}

    // this function is called whenever the symbol category changes
    symbolSelect.addEventListener("change", function(){
        const selectedSymbol = symbolInput.value;

        // this clears existing options in shares when change function is activated
        sharesInput.innerHTML = "";

        // populates the shares dropdown with appropriate amount of shares per stock option
        // ensure valid stock and number of shares is positive
        if (selectedSymbol && stockShares[selectedSymbol] > 0){
            const totalShares = stockShares[selectedSymbol];

            // loop from 1 until the total amount of shares for the stock
            for (let i = 1; i <= totalShares; i++){

                // create an option for each share that can be sold, start at
                const option = document.createElement("option");

                // store number of shares as option
                option.value = i;
                option.textContent = i;
                // add option element to the dropdown menu
                sharesInput.appendChild(option);
            }
        }
    });
});
</script>{% endblock %}
